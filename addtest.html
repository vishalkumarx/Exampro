<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Uploader</title>
    <!-- Include Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="mb-4">Upload Test to Firestore</h1>
        
        <!-- File Upload Section -->
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">Upload JSON File</h5>
                <input type="file" id="jsonFile" class="form-control mb-3" accept=".json">
                <button onclick="uploadToFirebase()" class="btn btn-primary">Upload to Firebase</button>
            </div>
        </div>

        <!-- Status Messages -->
        <div id="status" class="alert alert-info" role="alert" style="display: none;"></div>
    </div>

    <script>
        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        async function uploadToFirebase() {
            const fileInput = document.getElementById('jsonFile');
            const statusDiv = document.getElementById('status');
            
            if (!fileInput.files[0]) {
                showStatus('Please select a JSON file first!', 'danger');
                return;
            }

            try {
                // Read JSON file
                const file = fileInput.files[0];
                const reader = new FileReader();
                
                reader.onload = async (e) => {
                    try {
                        const jsonData = JSON.parse(e.target.result);
                        const batch = db.batch();
                        
                        // Process each test in JSON
                        for (const test of jsonData.tests) {
                            const testRef = db.collection('tests').doc();
                            
                            // Prepare test data
                            const testData = {
                                testName: test.testName,
                                testDate: new Date(test.testDate),
                                questions: test.questions.map(question => ({
                                    questionText: question.questionText,
                                    options: question.options,
                                    correctAnswer: question.correctAnswer,
                                    solution: question.solution,
                                    explanation: question.explanation
                                }))
                            };

                            batch.set(testRef, testData);
                        }

                        // Commit batch
                        await batch.commit();
                        showStatus('Successfully uploaded all tests to Firestore!', 'success');
                    } catch (error) {
                        showStatus(`Error processing file: ${error.message}`, 'danger');
                    }
                };

                reader.readAsText(file);
            } catch (error) {
                showStatus(`Error: ${error.message}`, 'danger');
            }
        }

        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.style.display = 'block';
            statusDiv.className = `alert alert-${type}`;
            statusDiv.textContent = message;
        }
    </script>
</body>
</html>
